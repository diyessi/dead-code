C     LEAST SQUARE POLYNOMIAL FIT                                       ANE20601
C                                                                       ANE20602
      SUBROUTINE LSQPOL(X,Y,W,RESID,N,SUM,L,A,B,M)                      ANE20603
C                                                                       ANE20604
      DIMENSION X(50),Y(50,1),RESID(50,1), A(20,8), B(20,1), C(50,8),   ANE20605
     X          SUM(1), W(50)                                           ANE20606
      COMMON C                                                          ANE20607
C                                                                       ANE20608
   10 DO 20 I=1,N                                                       ANE20609
   20 C(I,1)=1.0                                                        ANE20610
   30 DO 50 J=2,M                                                       ANE20611
   40 DO 50 I=1,N                                                       ANE20612
   50 C(I,J)=C(I,J-1)*X(I)                                              ANE20613
   60 DO 100 I=1,M                                                      ANE20614
   70 DO 100 J=1,M                                                      ANE20615
   80 A(I,J)=0.0                                                        ANE20616
   90 DO 100 K=1,N                                                      ANE20617
  100 A(I,J)=A(I,J)+C(K,I)*C(K,J)*W(K)                                  ANE20618
  105 DO 150 J=1,L                                                      ANE20619
  110 DO 150 I=1,M                                                      ANE20620
  120 B(I,J)=0.0                                                        ANE20621
  130 DO 150 K=1,N                                                      ANE20622
  150 B(I,J)=B(I,J)+C(K,I)*Y(K,J)*W(K)                                  ANE20623
  170 CALL MATINV (A,M,B, L,DETERM)                                     ANE20624
  180 DO 205 J=1,L                                                      ANE20625
  185 SUM(J)=0.0                                                        ANE20626
  192 DO 195 K=1,M                                                      ANE20627
  195 C(K,1)=B(K,J)                                                     ANE20628
  198 DO 205 I=1,N                                                      ANE20629
  200 RESID(I,J)=POLYE1F(X(I),M,XLOCF(C(1,1)))-Y(I,J)                   ANE20630
  205 SUM(J)=SUM(J)+RESID(I,J)**2*W(I)                                  ANE20631
  210 RETURN                                                            ANE20632
  220 END (2,2,2,2,1)                                                   ANE20633
